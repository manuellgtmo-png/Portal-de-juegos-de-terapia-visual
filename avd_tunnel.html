<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>T√∫nel Snellen - Perceptum AVD</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0b101b; --accent: #7000ff; --neon: #bc13fe; --error: #ff4757; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); font-family: 'Montserrat', sans-serif; overflow: hidden; color: white; }
        
        #header { height: 70px; display: flex; justify-content: space-between; align-items: center; padding: 0 25px; background: rgba(28,35,49,0.95); border-bottom: 3px solid var(--accent); position: relative; z-index: 100; box-shadow: 0 5px 20px rgba(0,0,0,0.5); }
        
        #stage { position: relative; width: 100%; height: calc(100vh - 180px); display: flex; align-items: center; justify-content: center; background: radial-gradient(circle, #1a1f2c 0%, #0b101b 100%); }
        
        .snellen-e { position: absolute; font-weight: 900; color: white; opacity: 0; pointer-events: none; text-shadow: 0 0 20px var(--neon); }
        
        /* Controles Gamer */
        #controls { height: 110px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 10px; background: #161b2a; border-top: 2px solid #2e3748; }
        .control-btn { background: #242b3d; border: 2px solid var(--accent); border-radius: 15px; color: white; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 0 var(--accent); }
        .control-btn:active { transform: translateY(4px); box-shadow: none; background: var(--accent); }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 1000; text-align: center; }
        .modal { background: #1c2331; padding: 40px; border-radius: 40px; border: 3px solid var(--neon); width: 85%; max-width: 450px; box-shadow: 0 0 30px rgba(188, 19, 254, 0.3); }
        .btn-start { background: linear-gradient(45deg, var(--accent), var(--neon)); color: white; padding: 18px; border-radius: 20px; border: none; font-weight: 900; cursor: pointer; width: 100%; text-transform: uppercase; font-size: 1.2rem; }
    </style>
</head>
<body>
    <div id="header">
        <div style="font-weight:900; color:var(--neon)">NIVEL: <span id="v-lvl">1</span></div>
        <div id="v-lives" style="font-size:1.6rem;">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
        <div style="font-weight:900;">ACIERTOS: <span id="v-hits">0</span></div>
    </div>

    <div id="stage"></div>

    <div id="controls">
        <div class="control-btn" onclick="checkDirection(180)">‚¨ÖÔ∏è</div>
        <div class="control-btn" onclick="checkDirection(270)">‚¨ÜÔ∏è</div>
        <div class="control-btn" onclick="checkDirection(90)">‚¨áÔ∏è</div>
        <div class="control-btn" onclick="checkDirection(0)">‚û°Ô∏è</div>
    </div>

    <div id="start-modal" class="overlay">
        <div class="modal">
            <h1 style="color:var(--neon); font-weight:900; font-size: 2.2rem; margin:0;">T√öNEL SNELLEN</h1>
            <p style="margin:20px 0; font-size: 1.1rem;">¬øHacia d√≥nde miran las patas de la E? Usa los botones inferiores.</p>
            <button class="btn-start" onclick="startGame()">¬°A JUGAR!</button>
        </div>
    </div>

    <script>
        let lvl = 1, hits = 0, lives = 3, active = false, speed = 4000;
        let currentRotation = 0;
        const stage = document.getElementById('stage');

        function startGame() {
            document.getElementById('start-modal').style.display = 'none';
            active = true;
            spawnTarget();
        }

        function spawnTarget() {
            if(!active) return;
            stage.innerHTML = '';
            const e = document.createElement('div');
            e.className = 'snellen-e';
            
            const orientations = [0, 90, 180, 270]; // 0=Der, 90=Abajo, 180=Izq, 270=Arriba
            currentRotation = orientations[Math.floor(Math.random()*4)];
            
            e.style.fontSize = Math.max(25, 100 - (lvl * 4)) + 'px';
            e.innerHTML = 'E';
            e.style.transform = `rotate(${currentRotation}deg)`;
            stage.appendChild(e);

            const anim = e.animate([
                { transform: `rotate(${currentRotation}deg) scale(0.1)`, opacity: 0 },
                { opacity: 1, offset: 0.3 },
                { transform: `rotate(${currentRotation}deg) scale(8)`, opacity: 0 }
            ], { duration: speed, iterations: 1, easing: 'ease-in' });

            anim.onfinish = () => { if(e.parentElement) { loseLive(); spawnTarget(); } };
        }

        function checkDirection(dir) {
            if(!active) return;
            if(dir === currentRotation) {
                hits++;
                document.getElementById('v-hits').innerText = hits;
                if(hits % 4 === 0) { lvl++; speed *= 0.9; document.getElementById('v-lvl').innerText = lvl; }
                stage.innerHTML = '';
                spawnTarget();
            } else {
                loseLive();
                stage.innerHTML = '';
                spawnTarget();
            }
        }

        function loseLive() {
            lives--;
            document.getElementById('v-lives').innerText = lives > 0 ? "‚ù§Ô∏è".repeat(lives) : "üíÄ";
            if(lives <= 0) location.reload();
        }
    </script>
</body>
</html>
