<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convergencia Pro - Perceptum</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.9);
            --accent-color: #38bdf8;
            --text-color: #f8fafc;
            --success: #10b981;
            --danger: #f472b6;
        }
        body {
            margin: 0; font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-color); color: var(--text-color);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; overflow: hidden;
        }

        /* CONTENEDORES PRINCIPALES */
        #setup-screen, #summary-screen {
            background: var(--card-bg); padding: 30px; border-radius: 30px;
            border: 2px solid var(--accent-color); text-align: center; 
            max-width: 600px; width: 90%; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            backdrop-filter: blur(10px); position: absolute; z-index: 10;
        }

        /* DEFINICI√ìN Y GU√çA VISUAL */
        .info-box { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 15px; margin: 15px 0; font-size: 0.85rem; line-height: 1.4; }
        .visual-guide { display: flex; justify-content: center; gap: 15px; margin: 15px 0; align-items: center; }
        .guide-item { border: 1px solid #444; padding: 5px 10px; border-radius: 8px; font-size: 0.7rem; }
        .guide-item.target { border: 2px solid var(--success); transform: scale(1.1); }

        .distancia-banner {
            background: rgba(56, 189, 248, 0.2); border: 1px dashed var(--accent-color);
            padding: 10px; border-radius: 12px; margin-bottom: 15px;
            font-weight: 900; color: var(--accent-color); text-transform: uppercase;
        }

        /* CONFIGURACI√ìN */
        .config-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .config-card { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 15px; }
        .config-card label { display: block; font-size: 0.65rem; font-weight: 900; color: var(--accent-color); margin-bottom: 5px; }
        input[type="range"] { width: 100%; accent-color: var(--accent-color); }

        /* √ÅREA DE JUEGO XXL */
        #game-area { display: none; width: 100%; height: 100%; flex-direction: column; justify-content: space-between; align-items: center; }
        .timer-header { text-align: center; margin-top: 20px; }
        .timer-val { font-size: 5rem; font-weight: 900; color: var(--accent-color); line-height: 1; }
        
        #stimulus-container { flex-grow: 1; display: flex; align-items: center; justify-content: center; gap: 100px; width: 100%; }
        .target-box { display: flex; flex-direction: column; align-items: center; justify-content: space-around; height: 50vh; width: 250px; }
        .glyph { font-size: 200px; color: #fff; filter: drop-shadow(0 0 10px rgba(255,255,255,0.5)); }
        .mark { font-size: 70px; font-weight: 900; color: #fff; }

        /* BARRA INFERIOR */
        .bottom-nav {
            background: var(--card-bg); padding: 20px 40px; border-radius: 40px 40px 0 0;
            border: 2px solid var(--accent-color); border-bottom: none;
            width: 85%; max-width: 900px; display: flex; justify-content: space-between; align-items: center;
        }
        .delta-display { font-size: 2.5rem; font-weight: 900; color: var(--accent-color); }
        .btn-group { display: flex; gap: 15px; }
        button { border: none; border-radius: 15px; font-family: 'Montserrat'; font-weight: 900; cursor: pointer; transition: 0.3s; }
        .btn-plus-minus { background: var(--accent-color); width: 60px; height: 55px; font-size: 1.8rem; }
        .btn-finish { background: var(--danger); color: white; padding: 0 20px; font-size: 0.8rem; }
        .btn-start { background: var(--success); width: 100%; padding: 18px; font-size: 1.2rem; border-radius: 20px; }
    </style>
</head>
<body>

    <div id="setup-screen">
        <h2 style="margin: 0; color: var(--accent-color);">CONVERGENCIA PRO</h2>
        <div class="info-box">
            La <b>convergencia</b> permite enfocar objetos cercanos coordinando ambos ojos. 
            Cruza la vista lentamente hasta que las figuras laterales se unan en una tercera imagen central.
        </div>
        
        <div class="distancia-banner">üìè Realizar tarea a 40 cm de distancia</div>

        <div class="visual-guide">
            <div class="guide-item">üè†<br>+</div>
            <div class="guide-item target"><b>+<br>üè†<br>-</b><br><small>OBJETIVO</small></div>
            <div class="guide-item">üè†<br>-</div>
        </div>

        <div class="config-row">
            <div class="config-card">
                <label>SERIES: <span id="l-series">3</span></label>
                <input type="range" id="i-series" min="1" max="10" value="3" oninput="updateL()">
            </div>
            <div class="config-card">
                <label>TRABAJO: <span id="l-work">20</span>s</label>
                <input type="range" id="i-work" min="5" max="60" value="20" step="5" oninput="updateL()">
            </div>
            <div class="config-card">
                <label>DESCANSO: <span id="l-rest">10</span>s</label>
                <input type="range" id="i-rest" min="5" max="30" value="10" step="5" oninput="updateL()">
            </div>
        </div>

        <button class="btn-start" onclick="startSession()">¬°COMENZAR SESI√ìN!</button>
    </div>

    <div id="summary-screen" style="display: none;">
        <h1 style="font-size: 4rem; margin: 0;">ü•≥</h1>
        <h2 style="color: var(--success);">¬°ENTRENAMIENTO EXITOSO!</h2>
        <p>Lograste una demanda m√°xima de:</p>
        <div style="font-size: 3rem; font-weight: 900; color: var(--accent-color); margin: 10px 0;"><span id="res-delta">0</span> Œî</div>
        <button class="btn-start" style="background: var(--accent-color);" onclick="resetToSetup()">REPETIR CONFIGURACI√ìN</button>
    </div>

    <div id="game-area">
        <div class="timer-header">
            <div id="timer-display" class="timer-val">00</div>
            <div id="status-label" style="letter-spacing: 4px; font-weight: 900; font-size: 1.2rem;">¬°FUSIONA!</div>
        </div>

        <div id="stimulus-container">
            <div id="box-l" class="target-box">
                <div class="mark">+</div>
                <div id="fig-l" class="glyph">üè†</div>
                <div class="mark" style="visibility: hidden;">-</div>
            </div>
            <div id="box-r" class="target-box">
                <div class="mark" style="visibility: hidden;">+</div>
                <div id="fig-r" class="glyph">üè†</div>
                <div class="mark">-</div>
            </div>
        </div>

        <div class="bottom-nav">
            <div>
                <div style="font-size: 0.7rem; opacity: 0.6; font-weight: 900;">DEMANDA</div>
                <div class="delta-display"><span id="demand-val">0</span> <small style="font-size: 1rem;">Œî</small></div>
            </div>
            <div class="btn-group">
                <button class="btn-plus-minus" onclick="adjust( -6 )">-</button>
                <button class="btn-plus-minus" onclick="adjust( 6 )">+</button>
                <button class="btn-finish" onclick="endEarly()">TERMINAR</button>
            </div>
        </div>
    </div>

    <script>
        let separation = 30;
        let seriesCount = 1;
        let isWorkPhase = true;
        let clock;
        let maxReached = 0;
        const figuras = ['üè†', 'ü¶Å', '‚≠ê', 'üîî', 'üå≥', 'üê±', 'üçé', 'üåô'];

        function updateL() {
            document.getElementById('l-series').innerText = document.getElementById('i-series').value;
            document.getElementById('l-work').innerText = document.getElementById('i-work').value;
            document.getElementById('l-rest').innerText = document.getElementById('i-rest').value;
        }

        function adjust(val) {
            separation += val;
            if(separation < 0) separation = 0;
            let d = Math.floor(separation / 3.2);
            if(d > maxReached) maxReached = d;
            draw();
        }

        function draw() {
            document.getElementById('box-l').style.transform = `translateX(${-separation}px)`;
            document.getElementById('box-r').style.transform = `translateX(${separation}px)`;
            document.getElementById('demand-val').innerText = Math.floor(separation / 3.2);
        }

        function resetToSetup() {
            document.getElementById('summary-screen').style.display = 'none';
            document.getElementById('setup-screen').style.display = 'block';
            seriesCount = 1;
            maxReached = 0;
        }

        function endEarly() {
            if(confirm("¬øDeseas finalizar y ver resultados?")) {
                clearInterval(clock);
                showFinal();
            }
        }

        function showFinal() {
            document.getElementById('game-area').style.display = 'none';
            document.getElementById('summary-screen').style.display = 'block';
            document.getElementById('res-delta').innerText = maxReached;
        }

        function startSession() {
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('game-area').style.display = 'flex';
            cycle();
        }

        function cycle() {
            let limit = parseInt(document.getElementById('i-series').value);
            let time = isWorkPhase ? parseInt(document.getElementById('i-work').value) : parseInt(document.getElementById('i-rest').value);
            
            document.getElementById('status-label').innerText = isWorkPhase ? "¬°MANT√âN LA FUSI√ìN!" : "DESCANSA";
            document.getElementById('status-label').style.color = isWorkPhase ? "var(--success)" : "var(--danger)";
            document.getElementById('stimulus-container').style.opacity = isWorkPhase ? "1" : "0.05";

            if(isWorkPhase) {
                const pick = figuras[Math.floor(Math.random() * figuras.length)];
                document.getElementById('fig-l').innerText = pick;
                document.getElementById('fig-r').innerText = pick;
            }

            clock = setInterval(() => {
                document.getElementById('timer-display').innerText = time < 10 ? "0"+time : time;
                if(time <= 0) {
                    clearInterval(clock);
                    if(isWorkPhase) {
                        isWorkPhase = false;
                        cycle();
                    } else {
                        seriesCount++;
                        if(seriesCount <= limit) {
                            isWorkPhase = true;
                            cycle();
                        } else {
                            showFinal();
                        }
                    }
                }
                time--;
            }, 1000);
        }

        updateL();
        draw();
    </script>
</body>
</html>
