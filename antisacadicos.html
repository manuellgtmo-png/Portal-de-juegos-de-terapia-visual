<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antisac√°dicos Pro - Versi√≥n Final Expandida</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #020617;
            --panel-bg: #1e293b;
            --purple-neon: #a855f7;
            --green-neon: #10b981;
            --red-neon: #ef4444;
            --text-white: #f8fafc;
            --shadow-glow: 0 0 30px rgba(168, 85, 247, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            color: var(--text-white);
            font-family: 'Montserrat', sans-serif;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- SISTEMA DE CAPAS (UI) --- */
        .full-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(2, 6, 23, 0.98);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            padding: 30px;
        }

        .main-card {
            background: var(--panel-bg);
            padding: 50px;
            border-radius: 40px;
            border: 6px solid var(--purple-neon);
            text-align: center;
            max-width: 850px;
            width: 100%;
            box-shadow: var(--shadow-glow);
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.5rem;
            color: var(--purple-neon);
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 4px;
        }

        .info-panel {
            text-align: left;
            background: rgba(0, 0, 0, 0.3);
            padding: 35px;
            border-radius: 25px;
            margin-bottom: 35px;
            border: 1px solid rgba(168, 85, 247, 0.2);
        }

        .info-panel p {
            font-size: 1.5rem;
            line-height: 1.8;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        /* --- SELECTORES Y RANGOS --- */
        .config-item {
            margin-bottom: 30px;
            text-align: left;
        }

        .config-item label {
            display: block;
            font-weight: 900;
            font-size: 1.3rem;
            color: var(--purple-neon);
            margin-bottom: 10px;
        }

        .ui-range {
            width: 100%;
            height: 15px;
            background: #334155;
            border-radius: 10px;
            accent-color: var(--purple-neon);
            cursor: pointer;
        }

        .btn-action {
            background: var(--green-neon);
            color: #000;
            border: none;
            padding: 25px;
            font-size: 2rem;
            font-weight: 900;
            border-radius: 25px;
            cursor: pointer;
            width: 100%;
            box-shadow: 0 10px 0 #065f46;
            transition: transform 0.1s;
        }

        .btn-action:active {
            transform: translateY(5px);
            box-shadow: 0 5px 0 #065f46;
        }

        /* --- JUEGO Y HUD --- */
        #hud-container {
            position: absolute;
            top: 0;
            width: 100%;
            padding: 25px 60px;
            display: none;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to bottom, rgba(2,6,23,1), rgba(2,6,23,0));
            z-index: 1000;
        }

        .hud-element {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
        }

        #game-stage {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: none;
        }

        .fix-cross {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 7rem;
            color: var(--purple-neon);
            opacity: 0.2;
        }

        .white-dot {
            position: absolute;
            width: 60px;
            height: 60px;
            background: #FFFFFF;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 40px #FFFFFF;
            z-index: 50;
        }

        .main-stimulus {
            position: absolute;
            font-family: 'Orbitron', sans-serif;
            font-size: 11rem;
            font-weight: 900;
            color: var(--purple-neon);
            transform: translate(-50%, -50%);
            text-shadow: 0 0 50px var(--purple-neon);
            z-index: 100;
            cursor: pointer;
        }

        /* --- FEEDBACK --- */
        .error-flash {
            animation: flashRed 0.4s ease-out;
        }

        @keyframes flashRed {
            50% { background-color: var(--red-neon); }
        }

        #modal-result {
            display: none;
        }
    </style>
</head>
<body>

    <div id="ui-intro" class="full-overlay">
        <div class="main-card">
            <h1>Antisac√°dicos</h1>
            <div class="info-panel">
                <p>üìè Mant√©n la distancia: <b>40 cm</b> [cite: 2026-02-10].</p>
                <p>üëÅÔ∏è Punto blanco: <b>¬°IGN√ìRALO!</b> Mira al lado opuesto.</p>
                <p>üëÑ <b>DILO:</b> Vocales y N√∫meros Pares.</p>
                <p>üëÜ <b>T√ìCALO:</b> Letras y N√∫meros Impares.</p>
            </div>
            <button class="btn-action" onclick="showConfig()">ENTENDIDO</button>
        </div>
    </div>

    <div id="ui-config" class="full-overlay" style="display: none;">
        <div class="main-card">
            <h1>Ajustes</h1>
            <div class="info-panel">
                <div class="config-item">
                    <label>Series por Nivel: <span id="lbl-series">3</span></label>
                    <input type="range" id="cfg-series" class="ui-range" min="1" max="10" value="3" oninput="document.getElementById('lbl-series').innerText=this.value">
                </div>
                <div class="config-item">
                    <label>Tiempo por Serie: <span id="lbl-work">30</span>s</label>
                    <input type="range" id="cfg-work" class="ui-range" min="10" max="60" value="30" oninput="document.getElementById('lbl-work').innerText=this.value">
                </div>
                <div class="config-item">
                    <label>Descanso: <span id="lbl-rest">10</span>s</label>
                    <input type="range" id="cfg-rest" class="ui-range" min="5" max="30" value="10" oninput="document.getElementById('lbl-rest').innerText=this.value">
                </div>
            </div>
            <button class="btn-action" style="background: var(--purple-neon); color: white;" onclick="initGame()">INICIAR ENTRENAMIENTO</button>
        </div>
    </div>

    <div id="hud-container">
        <div class="hud-element" style="color: var(--green-neon)">RELOJ: <span id="hud-time">30s</span></div>
        <div class="hud-element" id="hud-progress">NIVEL 1 - SERIE 1</div>
        <div class="hud-element" id="hud-lives" style="color: var(--red-neon)">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    </div>

    <div id="game-stage">
        <div class="fix-cross">+</div>
    </div>

    <div id="modal-result" class="full-overlay">
        <div class="main-card" style="border-color: var(--green-neon);">
            <h1 id="res-title" style="color: var(--green-neon);">¬°LOGRADO!</h1>
            <p style="font-size: 2.5rem; font-weight: 900; margin-bottom: 10px;">Aciertos: <span id="res-hits">0</span></p>
            <p id="res-info" style="color: var(--purple-neon); font-style: italic; margin-bottom: 30px;"></p>
            <button class="btn-action" onclick="continueFlow()">CONTINUAR</button>
        </div>
    </div>

    <script>
        // --- VARIABLES DE MOTOR ---
        let config_seriesPerLvl, config_timeWork, config_timeRest;
        let game_lvl = 1, game_serieAct = 1, game_lives = 3, game_hits = 0;
        let game_lvlBonusCounter = 0; // Para la vida extra cada 6 niveles
        
        let isRunning = false;
        let clockTimer = null;
        let spawnRef = null;
        let reactionRef = null;

        let activeStim = "";
        let activeModality = ""; // "VOZ" o "TOUCH"

        const list_voc = ['A', 'E', 'O', 'U'];
        const list_let = ['X', 'P', 'T', 'K', 'S', 'M', 'N'];
        const list_par = ['2', '4', '6', '8'];
        const list_imp = ['1', '3', '5', '7', '9'];

        // --- SPEECH ENGINE ---
        const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
        const speechMotor = new SpeechRec();
        speechMotor.lang = 'es-ES';
        speechMotor.continuous = true;
        speechMotor.interimResults = false;

        // --- AUDIO ENGINE ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playFeedback(f, t) {
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.type = t; o.frequency.setValueAtTime(f, audioCtx.currentTime);
            g.gain.setValueAtTime(0.1, audioCtx.currentTime);
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + 0.15);
        }

        // --- INTERFAZ ---
        function showConfig() {
            document.getElementById('ui-intro').style.display = 'none';
            document.getElementById('ui-config').style.display = 'flex';
        }

        function initGame() {
            config_seriesPerLvl = parseInt(document.getElementById('cfg-series').value);
            config_timeWork = parseInt(document.getElementById('cfg-work').value);
            config_timeRest = parseInt(document.getElementById('cfg-rest').value);

            document.getElementById('ui-config').style.display = 'none';
            document.getElementById('hud-container').style.display = 'flex';
            document.getElementById('game-stage').style.display = 'block';

            speechMotor.start();
            startSerieCycle();
        }

        // --- L√ìGICA DE JUEGO ---
        function startSerieCycle() {
            game_hits = 0;
            isRunning = true;
            updateHUD();
            launchClock();
            spawnLoop();
        }

        function spawnLoop() {
            if (!isRunning) return;

            const stage = document.getElementById('game-stage');
            stage.innerHTML = '<div class="fix-cross">+</div>';

            const leftSide = Math.random() > 0.5;
            const dotX = leftSide ? "20%" : "80%";
            const stimX = leftSide ? "80%" : "20%";

            // 1. Mostrar Punto Blanco (Distractor)
            const dot = document.createElement('div');
            dot.className = 'white-dot';
            dot.style.left = dotX;
            dot.style.top = "50%";
            stage.appendChild(dot);

            // 2. Delay para el antisac√°dico
            spawnRef = setTimeout(() => {
                if (!isRunning) return;
                dot.remove();

                // Selecci√≥n de Est√≠mulo
                const r = Math.random();
                if (r < 0.25) { activeStim = list_voc[Math.floor(Math.random()*list_voc.length)]; activeModality = "VOZ"; }
                else if (r < 0.50) { activeStim = list_let[Math.floor(Math.random()*list_let.length)]; activeModality = "TOUCH"; }
                else if (r < 0.75) { activeStim = list_par[Math.floor(Math.random()*list_par.length)]; activeModality = "VOZ"; }
                else { activeStim = list_imp[Math.floor(Math.random()*list_imp.length)]; activeModality = "TOUCH"; }

                const stim = document.createElement('div');
                stim.className = 'main-stimulus';
                stim.innerText = activeStim;
                stim.style.left = stimX;
                stim.style.top = "50%";
                
                stim.onclick = () => {
                    if (activeModality === "TOUCH") registerHit();
                    else registerMiss();
                };

                stage.appendChild(stim);

                // Tiempo de reacci√≥n (Dificultad escalada)
                const timeLimit = Math.max(900, 2600 - (game_lvl * 150));
                reactionRef = setTimeout(() => {
                    if (isRunning && stage.contains(stim)) registerMiss();
                }, timeLimit);

            }, 850);
        }

        // --- MANEJO DE ENTRADAS ---
        speechMotor.onresult = (e) => {
            if (!isRunning) return;
            const transcript = e.results[e.results.length - 1][0].transcript.toUpperCase();
            
            // INHIBICI√ìN: Si habla en modo TOUCH -> ERROR
            if (activeModality === "TOUCH") { registerMiss(); return; }

            if (activeModality === "VOZ" && transcript.includes(activeStim)) {
                registerHit();
            }
        };

        function registerHit() {
            clearTimeout(reactionRef);
            playFeedback(880, 'sine');
            game_hits++;
            document.getElementById('game-stage').innerHTML = '<div class="fix-cross">+</div>';
            setTimeout(spawnLoop, 500);
        }

        function registerMiss() {
            clearTimeout(reactionRef);
            clearTimeout(spawnRef);
            playFeedback(250, 'square');
            
            document.body.classList.add('error-flash');
            setTimeout(() => document.body.classList.remove('error-flash'), 350);
            
            game_lives--;
            updateHUD();

            if (game_lives <= 0) {
                gameOverReset();
            } else {
                document.getElementById('game-stage').innerHTML = '<div class="fix-cross">+</div>';
                setTimeout(spawnLoop, 900);
            }
        }

        // --- TIEMPOS Y PROGRESI√ìN ---
        function launchClock() {
            let remain = config_timeWork;
            clockTimer = setInterval(() => {
                remain--;
                document.getElementById('hud-time').innerText = remain + "s";
                if (remain <= 0) {
                    clearInterval(clockTimer);
                    endSerie();
                }
            }, 1000);
        }

        function endSerie() {
            isRunning = false;
            clearTimeout(spawnRef);
            clearTimeout(reactionRef);
            
            document.getElementById('res-hits').innerText = game_hits;
            document.getElementById('res-info').innerText = `Descansa ${config_timeRest} segundos.`;
            document.getElementById('modal-result').style.display = 'flex';
        }

        function gameOverReset() {
            isRunning = false;
            clearInterval(clockTimer);
            clearTimeout(spawnRef);
            clearTimeout(reactionRef);

            // Reset absoluto [cite: 2026-02-04]
            game_lvl = 1; game_serieAct = 1; game_lives = 3; game_lvlBonusCounter = 0;
            
            document.getElementById('game-stage').style.display = 'none';
            document.getElementById('hud-container').style.display = 'none';
            document.getElementById('ui-intro').style.display = 'flex';
        }

        function continueFlow() {
            document.getElementById('modal-result').style.display = 'none';
            
            if (game_serieAct < config_seriesPerLvl) {
                game_serieAct++;
            } else {
                game_serieAct = 1;
                game_lvl++;
                game_lvlBonusCounter++;
                
                // L√ìGICA DE VIDA EXTRA: CADA 6 NIVELES
                if (game_lvlBonusCounter >= 6) {
                    game_lives = Math.min(5, game_lives + 1);
                    game_lvlBonusCounter = 0;
                    document.getElementById('res-title').innerText = "¬°NIVEL 6 SUPERADO: +1 VIDA!";
                } else {
                    document.getElementById('res-title').innerText = "¬°NIVEL SUPERADO!";
                }
            }
            startSerieCycle();
        }

        function updateHUD() {
            document.getElementById('hud-progress').innerText = `NIVEL ${game_lvl} - SERIE ${game_serieAct}`;
            document.getElementById('hud-lives').innerText = "‚ù§Ô∏è".repeat(Math.max(0, game_lives));
        }

        speechMotor.onend = () => { if(isRunning) speechMotor.start(); };
    </script>
</body>
</html>
