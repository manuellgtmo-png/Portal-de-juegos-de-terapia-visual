<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tangram Vision - Centro Perceptum</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/interact.js/1.10.11/interact.min.js"></script>
    <style>
        :root {
            --bg-dark: #0f172a;
            --accent: #22c55e;
            --panel-light: #ffffff;
            --text-main: #f8fafc;
            /* Colores oficiales de las 7 piezas */
            --color-tg1: #ef4444; --color-tg2: #3b82f6; --color-tm: #f59e0b;
            --color-tp1: #8b5cf6; --color-tp2: #ec4899; --color-sq: #10b981;
            --color-rh: #f43f5e;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            touch-action: none;
        }

        /* --- MODAL DE INTRODUCCIÓN --- */
        #intro-modal {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.98);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-card {
            background: #1e293b;
            padding: 50px;
            border-radius: 40px;
            text-align: center;
            max-width: 600px;
            border: 3px solid var(--accent);
            box-shadow: 0 0 50px rgba(34, 197, 94, 0.2);
        }

        .modal-card h2 { font-size: 2.5rem; margin-bottom: 20px; text-transform: uppercase; color: var(--accent); }
        .modal-card p { font-size: 1.1rem; line-height: 1.6; margin-bottom: 30px; opacity: 0.9; }
        
        .start-btn {
            background: var(--accent);
            color: #0f172a;
            padding: 20px 50px;
            border-radius: 60px;
            font-size: 1.2rem;
            font-weight: 900;
            border: none;
            cursor: pointer;
            transition: 0.3s;
            text-transform: uppercase;
        }
        .start-btn:hover { transform: scale(1.05); background: #4ade80; }

        /* --- HEADER Y ESTADÍSTICAS --- */
        header {
            width: 100%;
            padding: 20px 40px;
            background: rgba(0,0,0,0.4);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo-text { font-weight: 900; letter-spacing: 2px; font-size: 1.2rem; }
        .stats-container { display: flex; gap: 30px; }
        .stat-item {
            background: rgba(255,255,255,0.05);
            padding: 10px 25px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            font-weight: 700;
        }
        .stat-item span { color: var(--accent); margin-left: 10px; }

        /* --- ÁREA DE JUEGO --- */
        .main-layout {
            display: flex;
            width: 100%;
            height: calc(100vh - 180px);
            padding: 20px;
            gap: 20px;
        }

        /* Lado Izquierdo: Zona de Trabajo */
        .work-zone {
            flex: 1.3;
            background: rgba(255,255,255,0.02);
            border: 4px dashed rgba(255,255,255,0.05);
            border-radius: 40px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Lado Derecho: Almacén de Piezas */
        .inventory-zone {
            flex: 1;
            background: var(--panel-light);
            border-radius: 40px;
            position: relative;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.1);
        }

        /* --- LAS 7 PIEZAS --- */
        .piece {
            position: absolute;
            cursor: grab;
            touch-action: none;
            z-index: 100;
            filter: drop-shadow(0 8px 15px rgba(0,0,0,0.2));
            transition: transform 0.1s ease-out;
        }
        .piece:active { cursor: grabbing; z-index: 1000; }

        /* Dimensiones exactas para Tangram */
        .tg { width: 180px; height: 180px; }
        .tm { width: 127px; height: 127px; }
        .tp { width: 90px; height: 90px; }
        .sq { width: 90px; height: 90px; }
        .rh { width: 135px; height: 90px; }

        /* --- ELEMENTOS DE CONTROL --- */
        .ui-footer {
            width: 100%;
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 30px;
        }

        .action-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 12px 30px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 700;
            transition: 0.3s;
        }
        .action-btn:hover { background: white; color: #0f172a; }

        .check-btn {
            background: var(--accent);
            border: none;
            color: #0f172a;
            padding: 12px 40px;
            border-radius: 30px;
            font-weight: 900;
            cursor: pointer;
            text-transform: uppercase;
        }

        #level-complete {
            position: fixed;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: var(--accent);
            color: #0f172a;
            padding: 30px 60px;
            border-radius: 30px;
            font-weight: 900;
            font-size: 2rem;
            display: none;
            z-index: 3000;
            box-shadow: 0 0 100px rgba(34, 197, 94, 0.5);
        }
    </style>
</head>
<body>

    <div id="intro-modal">
        <div class="modal-card">
            <h2>TANGRAM VISION</h2>
            <p><strong>INSTRUCCIONES:</strong><br>
            1. Arrastra las piezas del panel blanco a la zona oscura.<br>
            2. <strong>Toca/Haz Clic</strong> en una pieza para rotarla 45°.<br>
            3. Réplica la posición y orientación mental de los objetos.<br>
            4. Tarea a <strong>40 cm</strong> de distancia.</p>
            <button class="start-btn" onclick="iniciarJuego()">Comenzar Entrenamiento</button>
        </div>
    </div>

    <div id="level-complete">¡NIVEL COMPLETADO!</div>

    <header>
        <div class="logo-text">CENTRO PERCEPTUM</div>
        <div class="stats-container">
            <div class="stat-item">NIVEL: <span id="val-nivel">1</span></div>
            <div class="stat-item">TIEMPO: <span id="val-tiempo">00:00</span></div>
        </div>
    </header>

    <div class="main-layout">
        <div class="work-zone" id="zona-trabajo">
            </div>

        <div class="inventory-zone" id="almacen">
            <div class="piece tg" data-angle="0" style="top: 20px; left: 20px;">
                <svg viewBox="0 0 100 100" style="width:100%; height:100%"><polygon points="0,0 100,0 50,50" fill="var(--color-tg1)"/></svg>
            </div>
            <div class="piece tg" data-angle="0" style="top: 20px; left: 210px;">
                <svg viewBox="0 0 100 100" style="width:100%; height:100%"><polygon points="0,0 0,100 50,50" fill="var(--color-tg2)"/></svg>
            </div>
            <div class="piece tm" data-angle="0" style="top: 210px; left: 20px;">
                <svg viewBox="0 0 100 100" style="width:100%; height:100%"><polygon points="0,0 100,0 0,100" fill="var(--color-tm)"/></svg>
            </div>
            <div class="piece tp" data-angle="0" style="top: 210px; left: 160px;">
                <svg viewBox="0 0 100 100" style="width:100%; height:100%"><polygon points="50,50 100,100 0,100" fill="var(--color-tp1)"/></svg>
            </div>
            <div class="piece tp" data-angle="0" style="top: 210px; left: 260px;">
                <svg viewBox="0 0 100 100" style="width:100%; height:100%"><polygon points="0,0 50,50 0,100" fill="var(--color-tp2)"/></svg>
            </div>
            <div class="piece sq" data-angle="0" style="top: 350px; left: 20px;">
                <svg viewBox="0 0 100 100" style="width:100%; height:100%"><rect width="100" height="100" fill="var(--color-sq)"/></svg>
            </div>
            <div class="piece rh" data-angle="0" style="top: 350px; left: 130px;">
                <svg viewBox="0 0 150 100" style="width:100%; height:100%"><polygon points="50,0 150,0 100,100 0,100" fill="var(--color-rh)"/></svg>
            </div>
        </div>
    </div>

    <div class="ui-footer">
        <a href="menu-relaciones.html" class="action-btn">ABANDONAR</a>
        <button class="check-btn" onclick="comprobarNivel()">Comprobar Figura</button>
    </div>

    <script>
        let segundos = 0;
        let nivelActual = 1;
        let cronometro;

        function iniciarJuego() {
            document.getElementById('intro-modal').style.display = 'none';
            iniciarCronometro();
        }

        function iniciarCronometro() {
            cronometro = setInterval(() => {
                segundos++;
                let min = Math.floor(segundos / 60).toString().padStart(2, '0');
                let seg = (segundos % 60).toString().padStart(2, '0');
                document.getElementById('val-tiempo').innerText = `${min}:${seg}`;
            }, 1000);
        }

        // LÓGICA DE INTERACCIÓN (Interact.js)
        interact('.piece')
            .draggable({
                inertia: true,
                autoScroll: true,
                listeners: {
                    move(event) {
                        const target = event.target;
                        const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
                        const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;
                        const angle = target.getAttribute('data-angle') || 0;

                        target.style.transform = `translate(${x}px, ${y}px) rotate(${angle}deg)`;
                        target.setAttribute('data-x', x);
                        target.setAttribute('data-y', y);
                    }
                }
            })
            .on('tap', function (event) {
                const target = event.currentTarget;
                let angle = parseInt(target.getAttribute('data-angle')) || 0;
                angle = (angle + 45) % 360;
                
                const x = target.getAttribute('data-x') || 0;
                const y = target.getAttribute('data-y') || 0;

                target.setAttribute('data-angle', angle);
                target.style.transform = `translate(${x}px, ${y}px) rotate(${angle}deg)`;
            });

        function comprobarNivel() {
            // Animación de éxito y subida de nivel
            const banner = document.getElementById('level-complete');
            banner.style.display = 'block';
            
            setTimeout(() => {
                banner.style.display = 'none';
                nivelActual++;
                document.getElementById('val-nivel').innerText = nivelActual;
                // Aquí podrías añadir lógica para guardar en Google Sheets en el futuro
            }, 2000);
        }

        // Evitar que la pantalla se mueva en móviles
        document.addEventListener('touchmove', (e) => {
            if (e.touches.length > 1) e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>
