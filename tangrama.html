<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PERCEPTUM PRO | Siluetas de Diseño</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/interact.js/1.10.11/interact.min.js"></script>
    <style>
        /* --- ESTÉTICA ORIGINAL SIN TOCAR --- */
        :root {
            --bg-deep: #0f172a;
            --bg-panel: #1e293b;
            --bg-inv: #0a0f1a;
            --accent: #22c55e;
            --accent-glow: rgba(34, 197, 94, 0.3);
            --error: #ef4444;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            /* Colores Tangram Pro */
            --c1: #ff4757; --c2: #2e86de; --c3: #ffa502; 
            --c4: #2ed573; --c5: #a4b0be; --c6: #5352ed; --c7: #e056fd;
        }

        * { box-sizing: border-box; -webkit-user-select: none; user-select: none; margin: 0; padding: 0; }
        
        body { 
            font-family: 'Montserrat', sans-serif; background: var(--bg-deep); 
            color: var(--text-main); height: 100vh; overflow: hidden; display: flex; flex-direction: column;
        }

        /* --- LAUNCHER ESTÉTICO --- */
        #launcher {
            position: fixed; inset: 0; background: var(--bg-deep); z-index: 100000;
            display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px;
        }

        .hero-title { font-size: 5rem; font-weight: 900; color: var(--accent); text-shadow: 0 0 20px var(--accent-glow); }
        .hero-subtitle { font-size: 1.5rem; color: var(--text-dim); letter-spacing: 10px; margin-bottom: 40px; }

        .config-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; max-width: 1000px; width: 100%; margin-bottom: 40px;
        }

        .card-opt {
            background: var(--bg-panel); padding: 30px; border-radius: 30px; border: 4px solid transparent;
            cursor: pointer; transition: 0.3s;
        }
        .card-opt.active { border-color: var(--accent); background: #14532d; }
        .card-opt h3 { margin: 0 0 10px 0; color: var(--accent); font-size: 1.8rem; }

        .btn-start {
            background: var(--accent); color: var(--bg-deep); padding: 30px 100px;
            border-radius: 100px; font-weight: 900; font-size: 2.5rem; border: none; cursor: pointer;
        }

        /* --- UI PRINCIPAL --- */
        header {
            height: 110px; padding: 0 40px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.3); border-bottom: 2px solid rgba(255,255,255,0.1);
        }

        .logo-pro { font-size: 2.5rem; font-weight: 900; }
        .logo-pro span { color: var(--accent); }

        .hud-card { background: var(--bg-panel); padding: 10px 30px; border-radius: 20px; text-align: center; min-width: 180px; }
        .hud-card small { display: block; font-size: 0.8rem; color: var(--text-dim); text-transform: uppercase; }
        .hud-card b { font-size: 1.8rem; color: var(--accent); }

        /* --- VIEWPORT DE TRABAJO --- */
        .viewport { display: flex; flex: 1; padding: 25px; gap: 25px; overflow: visible; position: relative; }

        .panel-model {
            width: 420px; background: var(--bg-panel); border-radius: 40px;
            display: flex; flex-direction: column; padding: 25px; border: 3px solid var(--accent);
            position: relative; z-index: 10;
        }

        .screen-model { flex: 1; background: rgba(0,0,0,0.4); border-radius: 25px; position: relative; overflow: hidden; }
        
        .canvas-drop {
            flex: 1; border: 4px dashed rgba(255,255,255,0.1); border-radius: 50px;
            position: relative; z-index: 1; overflow: visible;
        }

        .panel-inv { width: 420px; background: var(--bg-inv); border-radius: 40px; position: relative; z-index: 10; overflow: visible; }

        /* --- PIEZAS PROFESIONALES --- */
        .piece {
            position: absolute !important; touch-action: none; cursor: grab;
            z-index: 9999 !important; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5));
        }
        .piece:active { cursor: grabbing; z-index: 10000 !important; transform: scale(1.05); }

        /* --- ACCIONES --- */
        .footer { height: 140px; display: flex; justify-content: center; align-items: center; gap: 30px; }
        .btn-act { padding: 25px 80px; border-radius: 100px; font-weight: 900; font-size: 1.6rem; border: none; cursor: pointer; text-transform: uppercase; }
        .btn-val { background: var(--accent); color: var(--bg-deep); }
        .btn-esc { background: var(--error); color: white; }

        /* --- MODAL --- */
        #modal {
            position: fixed; inset: 0; background: rgba(15,23,42,0.95);
            display: none; align-items: center; justify-content: center; z-index: 100000;
        }
        .modal-box { 
            background: var(--bg-panel); padding: 60px; border-radius: 50px; text-align: center; 
            border: 6px solid var(--accent); width: 90%; max-width: 600px;
        }
    </style>
</head>
<body>

    <div id="launcher">
        <h1 class="hero-title">CENTRO PERCEPTUM</h1>
        <p class="hero-subtitle">TANGRAM VISUAL TRAINING</p>
        
        <div class="config-grid">
            <div class="card-opt active" data-m="copy" onclick="setM(this)">
                <h3>COPIA DIRECTA</h3>
                <p>Forma el diseño tal cual se muestra.</p>
            </div>
            <div class="card-opt" data-m="mirrorV" onclick="setM(this)">
                <h3>ESPEJO VERTICAL</h3>
                <p>Invierte derecha e izquierda.</p>
            </div>
            <div class="card-opt" data-m="mirrorH" onclick="setM(this)">
                <h3>ESPEJO HORIZONTAL</h3>
                <p>Reflejo tipo agua (Arriba/Abajo).</p>
            </div>
            <div class="card-opt" data-m="rotate180" onclick="setM(this)">
                <h3>ROTACIÓN 180°</h3>
                <p>Giro mental completo de la figura.</p>
            </div>
        </div>

        <button class="btn-start" onclick="initGame()">INICIAR ENTRENAMIENTO</button>
    </div>

    <header>
        <div class="logo-pro">PERCEPTUM<span>PRO</span></div>
        <div style="display:flex; gap:20px;">
            <div class="hud-card"><small>Nivel</small><b id="ui-lvl">1</b></div>
            <div class="hud-card"><small>Tiempo</small><b id="ui-time">00:00</b></div>
            <div class="hud-card"><small>Vidas</small><b id="ui-hp" style="color:var(--error)">❤️❤️❤️</b></div>
        </div>
    </header>

    <div class="viewport">
        <div class="panel-model">
            <div class="screen-model" id="m-view"></div>
            <p style="text-align:center; font-weight:900; color:var(--accent); margin-top:15px;">DISEÑO OBJETIVO</p>
        </div>

        <div class="canvas-drop" id="drop-zone"></div>

        <div class="panel-inv">
            <p style="text-align:center; padding:20px; color:var(--text-dim); font-weight:700;">PIEZAS DISPONIBLES</p>
            <div id="i-view" style="position:relative; height:100%;"></div>
        </div>
    </div>

    <div class="footer">
        <button class="btn-act btn-esc" onclick="location.reload()">Cerrar</button>
        <button class="btn-act btn-val" onclick="checkWin()">Validar Figura</button>
    </div>

    <div id="modal">
        <div class="modal-box">
            <h2 id="modal-h" style="font-size:4rem; margin-bottom:20px;">¡LOGRADO!</h2>
            <p id="modal-p" style="font-size:1.5rem; color:var(--text-dim); margin-bottom:40px;"></p>
            <button class="btn-act btn-val" id="modal-btn" style="width:100%">CONTINUAR</button>
        </div>
    </div>

    <script>
        // --- BASE DE DATOS DE PIEZAS ---
        const SHAPES = [
            { id:0, pts: "0,0 100,0 50,50", c: 'var(--c1)', w:140, h:140 }, // TriG1
            { id:1, pts: "100,0 100,100 50,50", c: 'var(--c2)', w:140, h:140 }, // TriG2
            { id:2, pts: "0,0 50,50 0,100", c: 'var(--c3)', w:100, h:100 }, // TriM
            { id:3, pts: "50,50 100,100 0,100", c: 'var(--c4)', w:80, h:80 }, // TriP1
            { id:4, pts: "0,0 50,0 25,25", c: 'var(--c5)', w:80, h:80 }, // TriP2
            { id:5, pts: "0,0 50,0 50,50 0,50", c: 'var(--c6)', w:90, h:90 }, // Cuadrado
            { id:6, pts: "25,0 75,0 50,50 0,50", c: 'var(--c7)', w:110, h:80 }  // Romboide
        ];

        // --- DISEÑOS DE FIGURAS (ESTO HACE QUE SE VEA BIEN) ---
        // Coordenadas relativas para que las piezas encajen formando figuras
        const DESIGNS = [
            { name: "EL BARCO", pieces: [
                {i:0, x:-40, y:20, a:0}, {i:1, x:40, y:20, a:0}, {i:5, x:0, y:-40, a:0}, {i:3, x:0, y:60, a:180}
            ]},
            { name: "EL GATO", pieces: [
                {i:5, x:0, y:-80, a:0}, {i:3, x:-30, y:-120, a:0}, {i:4, x:30, y:-120, a:0}, {i:0, x:0, y:0, a:0}, {i:6, x:50, y:60, a:90}
            ]},
            { name: "EL PÁJARO", pieces: [
                {i:2, x:-50, y:0, a:90}, {i:5, x:0, y:0, a:0}, {i:1, x:60, y:-20, a:270}, {i:4, x:20, y:-70, a:0}
            ]},
            { name: "EL COHETE", pieces: [
                {i:3, x:0, y:-80, a:0}, {i:0, x:-40, y:0, a:0}, {i:1, x:40, y:0, a:0}, {i:5, x:0, y:80, a:0}
            ]},
            { name: "LA CASA", pieces: [
                {i:0, x:-40, y:0, a:0}, {i:1, x:40, y:0, a:0}, {i:5, x:0, y:80, a:0}, {i:2, x:0, y:140, a:180}
            ]}
        ];

        let state = { lvl:1, hp:3, time:0, mode:'copy', targets:[] };

        function setM(el) {
            document.querySelectorAll('.card-opt').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            state.mode = el.dataset.m;
        }

        function initGame() {
            document.getElementById('launcher').style.display = 'none';
            setInterval(() => { state.time++; updateUI(); }, 1000);
            loadLvl();
        }

        function updateUI() {
            const m = Math.floor(state.time/60).toString().padStart(2,'0');
            const s = (state.time%60).toString().padStart(2,'0');
            document.getElementById('ui-time').innerText = `${m}:${s}`;
            document.getElementById('ui-lvl').innerText = state.lvl;
            document.getElementById('ui-hp').innerText = "❤️".repeat(state.hp);
        }

        function loadLvl() {
            const mZone = document.getElementById('m-view');
            const iZone = document.getElementById('i-view');
            mZone.innerHTML = ''; iZone.innerHTML = '';
            
            // Seleccionar un diseño según el nivel (vuelve a empezar o escala)
            const design = DESIGNS[(state.lvl - 1) % DESIGNS.length];
            state.targets = [];

            design.pieces.forEach((p, idx) => {
                const shape = SHAPES[p.i];
                state.targets.push({ id: idx, x: p.x, y: p.y, a: p.a });

                // Crear Referencia (Modelo)
                drawPiece(shape, mZone, p.x, p.y, p.a, true, idx);
                // Crear Jugable (Inventario)
                drawPiece(shape, iZone, 0, (idx * 90) - 150, 0, false, idx);
            });

            initInteract();
        }

        function drawPiece(shape, container, x, y, a, isRef, id) {
            const div = document.createElement('div');
            div.className = 'piece';
            div.style.width = (isRef ? shape.w * 0.6 : shape.w) + 'px';
            div.style.height = (isRef ? shape.h * 0.6 : shape.h) + 'px';
            
            if(isRef) {
                div.style.left = '50%'; div.style.top = '50%';
                div.style.transform = `translate(-50%, -50%) translate(${x * 0.6}px, ${y * 0.6}px) rotate(${a}deg)`;
                div.style.opacity = "0.4"; div.style.pointerEvents = "none";
            } else {
                div.style.left = '120px'; div.style.top = '250px';
                div.setAttribute('data-id', id); div.setAttribute('data-ang', 0);
                div.setAttribute('data-x', 0); div.setAttribute('data-y', 0);
            }

            div.innerHTML = `<svg viewBox="0 0 100 100"><polygon points="${shape.pts}" fill="${shape.c}"/></svg>`;
            container.appendChild(div);
        }

        function initInteract() {
            interact('.piece:not([style*="pointer-events: none"])').draggable({
                listeners: { move(e) {
                    const t = e.target;
                    const x = (parseFloat(t.getAttribute('data-x')) || 0) + e.dx;
                    const y = (parseFloat(t.getAttribute('data-y')) || 0) + e.dy;
                    t.style.transform = `translate(${x}px, ${y}px) rotate(${t.getAttribute('data-ang')}deg)`;
                    t.setAttribute('data-x', x); t.setAttribute('data-y', y);
                }}
            }).on('tap', (e) => {
                const t = e.currentTarget;
                let ang = (parseInt(t.getAttribute('data-ang')) || 0) + 90;
                t.setAttribute('data-ang', ang);
                t.style.transform = `translate(${t.getAttribute('data-x') || 0}px, ${t.getAttribute('data-y') || 0}px) rotate(${ang}deg)`;
            });
        }

        function checkWin() {
            const stage = document.getElementById('drop-zone').getBoundingClientRect();
            const cx = stage.left + stage.width / 2;
            const cy = stage.top + stage.height / 2;
            let hits = 0;

            state.targets.forEach(tgt => {
                const p = document.querySelector(`[data-id="${tgt.id}"]`);
                const r = p.getBoundingClientRect();
                const curX = (r.left + r.width/2) - cx;
                const curY = (r.top + r.height/2) - cy;
                const curA = (parseInt(p.getAttribute('data-ang')) || 0) % 360;

                let tx = tgt.x, ty = tgt.y, ta = tgt.a;
                if(state.mode === 'mirrorV') tx = -tgt.x;
                if(state.mode === 'mirrorH') ty = -tgt.y;
                if(state.mode === 'rotate180') { tx = -tgt.x; ty = -tgt.y; ta = (tgt.a + 180) % 360; }

                const d = Math.sqrt(Math.pow(curX - tx, 2) + Math.pow(curY - ty, 2));
                if(d < 60 && (curA + 360)%360 === (ta + 360)%360) hits++;
            });

            if(hits === state.targets.length) {
                showM("¡EXCELENTE!", "Diseño completado. Pasando al siguiente nivel.", () => {
                    state.lvl++; document.getElementById('modal').style.display='none'; loadLvl();
                }, false);
            } else {
                state.hp--; updateUI();
                if(state.hp <= 0) showM("FIN", "Sesión terminada.", () => location.reload(), true);
                else showM("ERROR", "La figura no coincide.", () => document.getElementById('modal').style.display='none', true);
            }
        }

        function showM(h, p, act, err) {
            document.getElementById('modal-h').innerText = h;
            document.getElementById('modal-p').innerText = p;
            const b = document.getElementById('modal-btn');
            b.style.background = err ? 'var(--error)' : 'var(--accent)';
            b.onclick = act;
            document.getElementById('modal').style.display = 'flex';
        }
    </script>
</body>
</html>
