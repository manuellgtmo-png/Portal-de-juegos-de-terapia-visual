<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PERCEPTUMPRO | Visual Training</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/interact.js/1.10.11/interact.min.js"></script>
    <style>
        :root {
            --bg-deep: #0f172a;
            --bg-panel: #1e293b;
            --bg-inv: #0a0f1a;
            --accent: #22c55e; /* El verde brillante de tu botón */
            --accent-glow: rgba(34, 197, 94, 0.4);
            --error: #ef4444;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            /* Colores de piezas según tu diseño */
            --c1: #ff4757; --c2: #2e86de; --c3: #ffa502; 
            --c4: #2ed573; --c5: #a4b0be; --c6: #5352ed; --c7: #e056fd;
        }

        * { box-sizing: border-box; -webkit-user-select: none; user-select: none; margin: 0; padding: 0; }
        
        body { 
            font-family: 'Montserrat', sans-serif; background: var(--bg-deep); 
            color: var(--text-main); height: 100vh; overflow: hidden; display: flex; flex-direction: column;
        }

        /* --- LAUNCHER (ESTÉTICA FIEL A TU CAPTURA) --- */
        #launcher {
            position: fixed; inset: 0; background: var(--bg-deep); z-index: 100000;
            display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px;
        }

        .logo-main { font-size: 3.5rem; font-weight: 900; margin-bottom: 5px; letter-spacing: -2px; }
        .logo-main span { color: var(--accent); }

        .hero-section { text-align: center; margin-bottom: 40px; }
        .hero-title { font-size: 4rem; font-weight: 900; color: var(--accent); line-height: 1; }
        .hero-subtitle { font-size: 1.2rem; color: var(--text-dim); letter-spacing: 8px; margin-top: 10px; }

        .config-container {
            display: grid; grid-template-columns: repeat(2, 300px) 300px; gap: 20px;
            max-width: 1000px; margin-bottom: 40px;
        }

        .mode-card {
            background: var(--bg-panel); padding: 25px; border-radius: 25px; border: 4px solid transparent;
            cursor: pointer; transition: 0.3s;
        }
        .mode-card.active { border-color: var(--accent); background: rgba(34, 197, 94, 0.1); }
        .mode-card h3 { color: var(--accent); font-size: 1.4rem; margin-bottom: 10px; text-transform: uppercase; }
        .mode-card p { font-size: 0.85rem; color: var(--text-dim); line-height: 1.3; }

        .timer-panel {
            background: var(--bg-panel); border-radius: 25px; padding: 25px;
            display: flex; flex-direction: column; justify-content: center; gap: 20px;
        }
        .radio-opt { display: flex; align-items: center; gap: 10px; font-weight: 900; font-size: 1.1rem; cursor: pointer; }
        .radio-opt input { accent-color: var(--accent); transform: scale(1.5); }

        .btn-main-start {
            background: var(--accent); color: var(--bg-deep); width: 600px; padding: 25px;
            border-radius: 50px; font-weight: 900; font-size: 2.2rem; border: none; cursor: pointer;
            box-shadow: 0 10px 30px var(--accent-glow); transition: 0.3s;
        }
        .btn-main-start:hover { transform: scale(1.02); filter: brightness(1.1); }

        /* --- UI DE JUEGO --- */
        header {
            height: 90px; padding: 0 40px; display: flex; justify-content: space-between; align-items: center;
        }

        .hud { display: flex; gap: 15px; }
        .hud-item { background: #1a2235; padding: 10px 25px; border-radius: 15px; text-align: center; min-width: 140px; }
        .hud-item small { display: block; font-size: 0.65rem; color: var(--text-dim); text-transform: uppercase; margin-bottom: 2px; }
        .hud-item b { font-size: 1.5rem; color: var(--accent); }

        .game-world { display: flex; flex: 1; padding: 20px 40px; gap: 30px; overflow: visible; }

        .panel-side {
            width: 320px; background: var(--bg-panel); border-radius: 35px;
            padding: 20px; display: flex; flex-direction: column; border: 2px solid var(--accent);
            position: relative; z-index: 10;
        }
        .model-screen { flex: 1; background: rgba(0,0,0,0.5); border-radius: 20px; position: relative; overflow: hidden; }
        
        .central-stage { flex: 1; position: relative; z-index: 1; overflow: visible; }

        .inventory-panel {
            width: 320px; background: #0c1220; border-radius: 35px; position: relative; z-index: 10; overflow: visible;
        }

        /* --- PIEZAS (Z-INDEX MÁXIMO PARA NO PERDERLAS) --- */
        .piece {
            position: absolute !important; touch-action: none; cursor: grab;
            z-index: 9999 !important; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.6));
        }
        .piece:active { cursor: grabbing; z-index: 10000 !important; }

        /* --- FOOTER (BOTONES ROJO Y VERDE DE TU CAPTURA) --- */
        .game-footer { height: 120px; display: flex; justify-content: center; align-items: center; gap: 30px; }
        .btn-foot { padding: 18px 60px; border-radius: 50px; font-weight: 900; font-size: 1.4rem; border: none; cursor: pointer; text-transform: uppercase; }
        .btn-red { background: #ef4444; color: white; }
        .btn-green { background: var(--accent); color: var(--bg-deep); }

        #modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: none; align-items: center; justify-content: center; z-index: 1000000;
        }
        .modal-box { 
            background: var(--bg-panel); padding: 50px; border-radius: 40px; text-align: center; 
            border: 5px solid var(--accent); width: 500px;
        }
    </style>
</head>
<body>

    <div id="launcher">
        <div class="logo-main">PERCEPTUM<span>PRO</span></div>
        <div class="hero-section">
            <h1 class="hero-title">CENTRO PERCEPTUM</h1>
            <p class="hero-subtitle">TANGRAM VISUAL TRAINING</p>
        </div>
        
        <div class="config-container">
            <div class="mode-card active" data-m="copy" onclick="selM(this)">
                <h3>COPIA DIRECTA</h3>
                <p>Misma posición y orientación. Ideal para trabajar atención y constancia de forma.</p>
            </div>
            <div class="mode-card" data-m="mirrorV" onclick="selM(this)">
                <h3>ESPEJO VERTICAL</h3>
                <p>Invierte el eje X. Trabaja la lateralidad y el cruce de línea media.</p>
            </div>
            <div class="timer-panel">
                <label class="radio-opt"><input type="radio" name="tt" value="cron" checked> CRONÓMETRO</label>
                <label class="radio-opt"><input type="radio" name="tt" value="contra"> CONTRARRELOJ</label>
            </div>
        </div>

        <button class="btn-main-start" onclick="initGame()">INICIAR ENTRENAMIENTO</button>
        <p style="margin-top:20px; color:var(--text-dim); font-weight:700;">REALIZAR TAREA A 40 CM DE DISTANCIA</p>
    </div>

    <header>
        <div class="logo-pro" style="font-weight:900; font-size:2rem;">PERCEPTUM<span>PRO</span></div>
        <div class="hud">
            <div class="hud-item"><small>Nivel Actual</small><b id="ui-lvl">1</b></div>
            <div class="hud-item"><small>Reloj</small><b id="ui-time">00:00</b></div>
            <div class="hud-item"><small>Vidas</small><b id="ui-hp" style="color:#ff4757">❤️❤️❤️</b></div>
        </div>
    </header>

    <div class="game-world">
        <div class="panel-side">
            <div class="model-screen" id="model-area"></div>
            <p style="text-align:center; font-weight:900; color:var(--accent); margin-top:15px; font-size:0.9rem;">MODELO OBJETIVO</p>
        </div>

        <div class="central-stage" id="drop-zone"></div>

        <div class="inventory-panel">
            <p style="text-align:center; padding:15px; color:var(--text-dim); font-weight:900; font-size:0.8rem;">PIEZAS</p>
            <div id="inv-area" style="position:relative; height:100%;"></div>
        </div>
    </div>

    <div class="game-footer">
        <button class="btn-foot btn-red" onclick="location.reload()">Cerrar</button>
        <button class="btn-foot btn-green" onclick="validate()">Validar Figura</button>
    </div>

    <div id="modal">
        <div class="modal-box">
            <h2 id="m-h" style="font-size:3rem; margin-bottom:15px; color:var(--accent);">¡LOGRADO!</h2>
            <p id="m-p" style="font-size:1.2rem; margin-bottom:30px;"></p>
            <button class="btn-main-start" id="m-btn" style="width:100%; font-size:1.5rem;">CONTINUAR</button>
        </div>
    </div>

    <script>
        // --- BASE DE DATOS DE PIEZAS ---
        const SHAPES = [
            { id:0, pts: "0,0 100,0 50,50", c: 'var(--c1)', w:130, h:130 },
            { id:1, pts: "100,0 100,100 50,50", c: 'var(--c2)', w:130, h:130 },
            { id:2, pts: "0,0 50,50 0,100", c: 'var(--c3)', w:90, h:90 },
            { id:3, pts: "50,50 100,100 0,100", c: 'var(--c4)', w:70, h:70 },
            { id:4, pts: "0,0 50,0 25,25", c: 'var(--c5)', w:70, h:70 },
            { id:5, pts: "0,0 50,0 50,50 0,50", c: 'var(--c6)', w:85, h:85 },
            { id:6, pts: "25,0 75,0 50,50 0,50", c: 'var(--c7)', w:100, h:75 }
        ];

        // --- LIBRERÍA DE FIGURAS REALES (COORDENADAS LIMPIAS) ---
        const DESIGNS = [
            { n: "EL CISNE", p: [{i:0,x:0,y:40,a:0},{i:5,x:0,y:-30,a:0},{i:3,x:-30,y:-70,a:0}] },
            { n: "LA FLECHA", p: [{i:0,x:-30,y:0,a:90},{i:1,x:30,y:0,a:270},{i:6,x:0,y:60,a:0}] },
            { n: "EL GATO", p: [{i:5,x:0,y:-50,a:0},{i:0,x:0,y:20,a:0},{i:6,x:40,y:60,a:90}] },
            { n: "EL BARCO", p: [{i:0,x:-35,y:0,a:0},{i:1,x:35,y:0,a:0},{i:5,x:0,y:60,a:0}] }
        ];

        let state = { lvl:1, hp:3, time:0, mode:'copy', targets:[] };

        function selM(el) {
            document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            state.mode = el.dataset.m;
        }

        function initGame() {
            document.getElementById('launcher').style.display = 'none';
            setInterval(() => { state.time++; updateHUD(); }, 1000);
            loadLvl();
        }

        function updateHUD() {
            const m = Math.floor(state.time/60).toString().padStart(2,'0');
            const s = (state.time%60).toString().padStart(2,'0');
            document.getElementById('ui-time').innerText = `${m}:${s}`;
            document.getElementById('ui-lvl').innerText = state.lvl;
            document.getElementById('ui-hp').innerText = "❤️".repeat(state.hp);
        }

        function loadLvl() {
            const mv = document.getElementById('model-area');
            const iv = document.getElementById('inv-area');
            mv.innerHTML = ''; iv.innerHTML = '';
            
            const design = DESIGNS[(state.lvl-1) % DESIGNS.length];
            state.targets = [];

            design.p.forEach((p, idx) => {
                const shape = SHAPES[p.i];
                state.targets.push({ id: idx, x: p.x, y: p.y, a: p.a });

                // Modelo (Con silueta negra si nivel > 30)
                draw(shape, mv, p.x, p.y, p.a, true, idx, state.lvl > 30);
                // Inventario
                draw(shape, iv, 0, (idx*80)-120, 0, false, idx, false);
            });

            initInteract();
        }

        function draw(shape, container, x, y, a, isRef, id, isSil) {
            const div = document.createElement('div');
            div.className = 'piece';
            const scale = isRef ? 0.6 : 1;
            div.style.width = (shape.w * scale) + 'px';
            div.style.height = (shape.h * scale) + 'px';
            
            if(isRef) {
                div.style.left = '50%'; div.style.top = '50%';
                div.style.transform = `translate(-50%, -50%) translate(${x*scale}px, ${y*scale}px) rotate(${a}deg)`;
                div.style.opacity = isSil ? "1" : "0.5";
            } else {
                div.style.left = '100px'; div.style.top = '220px';
                div.setAttribute('data-id', id); div.setAttribute('data-ang', 0);
                div.setAttribute('data-x', 0); div.setAttribute('data-y', 0);
            }

            const fill = isSil ? '#000' : shape.c;
            div.innerHTML = `<svg viewBox="0 0 100 100"><polygon points="${shape.pts}" fill="${fill}" stroke="rgba(255,255,255,0.1)"/></svg>`;
            container.appendChild(div);
        }

        function initInteract() {
            interact('.piece:not([style*="left: 50%"])').draggable({
                listeners: { move(e) {
                    const t = e.target;
                    const x = (parseFloat(t.getAttribute('data-x')) || 0) + e.dx;
                    const y = (parseFloat(t.getAttribute('data-y')) || 0) + e.dy;
                    t.style.transform = `translate(${x}px, ${y}px) rotate(${t.getAttribute('data-ang')}deg)`;
                    t.setAttribute('data-x', x); t.setAttribute('data-y', y);
                }}
            }).on('tap', (e) => {
                const t = e.currentTarget;
                let ang = (parseInt(t.getAttribute('data-ang')) || 0) + 90;
                t.setAttribute('data-ang', ang);
                t.style.transform = `translate(${t.getAttribute('data-x') || 0}px, ${t.getAttribute('data-y') || 0}px) rotate(${ang}deg)`;
            });
        }

        function validate() {
            const stage = document.getElementById('drop-zone').getBoundingClientRect();
            const cx = stage.left + stage.width/2;
            const cy = stage.top + stage.height/2;
            let hits = 0;

            state.targets.forEach(tgt => {
                const p = document.querySelector(`[data-id="${tgt.id}"]`);
                const r = p.getBoundingClientRect();
                const curX = (r.left + r.width/2) - cx;
                const curY = (r.top + r.height/2) - cy;
                const curA = (parseInt(p.getAttribute('data-ang')) || 0) % 360;

                let tx = tgt.x, ty = tgt.y, ta = tgt.a;
                if(state.mode === 'mirrorV') tx = -tgt.x;

                const d = Math.sqrt(Math.pow(curX - tx, 2) + Math.pow(curY - ty, 2));
                if(d < 50 && (curA + 360)%360 === (ta + 360)%360) hits++;
            });

            if(hits === state.targets.length) {
                showModal("¡EXCELENTE!", "Figura completada correctamente.", () => {
                    state.lvl++; document.getElementById('modal').style.display='none'; loadLvl();
                }, false);
            } else {
                state.hp--; updateHUD();
                if(state.hp <= 0) showModal("SESIÓN FINALIZADA", "Inténtalo de nuevo.", () => location.reload(), true);
                else showModal("REINTENTAR", "La posición no es exacta.", () => document.getElementById('modal').style.display='none', true);
            }
        }

        function showModal(h, p, act, isErr) {
            document.getElementById('m-h').innerText = h;
            document.getElementById('m-p').innerText = p;
            document.getElementById('m-h').style.color = isErr ? 'var(--error)' : 'var(--accent)';
            const btn = document.getElementById('m-btn');
            btn.onclick = act;
            document.getElementById('modal').style.display = 'flex';
        }
    </script>
</body>
</html>
