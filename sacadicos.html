<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sac√°dicos Din√°micos - Perceptum</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Roboto+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #020617;
            --accent-color: #a855f7;
            --text-color: #f8fafc;
            --success: #10b981;
        }
        body {
            margin: 0; font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-color); color: var(--text-color);
            height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden;
        }

        .screen {
            background: rgba(30, 41, 59, 0.95); padding: 40px; border-radius: 40px;
            border: 3px solid var(--accent-color); text-align: center;
            max-width: 650px; width: 90%; box-shadow: 0 0 50px rgba(168, 85, 247, 0.3);
            display: none; position: absolute; z-index: 100;
        }
        .active { display: block; animation: fadeIn 0.3s ease; }

        /* REJILLA DIN√ÅMICA */
        #game-area { 
            display: none; width: 95vw; height: 90vh; 
            grid-template-columns: repeat(5, 1fr); 
            grid-template-rows: repeat(6, 1fr);
            gap: 15px; padding: 40px; box-sizing: border-box;
        }
        .slot {
            display: flex; align-items: center; justify-content: center;
            perspective: 1000px;
        }
        .stimulus {
            font-family: 'Roboto Mono', monospace; font-size: 4rem;
            color: #1e293b; transition: all 0.1s ease;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .stimulus.active {
            color: var(--accent-color);
            transform: scale(1.3) translate(var(--rx), var(--ry));
            filter: drop-shadow(0 0 20px var(--accent-color));
        }
        .stimulus.distractor { color: #475569; opacity: 0.2; }

        .btn-main { background: var(--success); color: #000; border: none; padding: 20px; border-radius: 20px; font-weight: 900; font-size: 1.5rem; cursor: pointer; width: 100%; margin-top: 20px; box-shadow: 0 10px 0 #059669; }
        .btn-main:active { transform: translateY(5px); box-shadow: 0 5px 0 #059669; }
    </style>
</head>
<body>

    <div id="s1" class="screen active">
        <h1 style="color: var(--accent-color); font-size: 2.5rem;">ENTRENAMIENTO SAC√ÅDICO DIN√ÅMICO</h1>
        <p style="font-size: 1.2rem;">Los n√∫meros aparecer√°n en r√°fagas. <br><b style="color: var(--success);">¬°N√≥mbralos antes de que se apaguen!</b></p>
        <div style="text-align: left; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 20px; border-left: 5px solid var(--accent-color);">
            üöÄ <b>Distancia:</b> 40 cm.<br>
            üß† <b>Reto:</b> Ignora los s√≠mbolos tenues, solo di los n√∫meros brillantes.<br>
            ‚ö° <b>Velocidad:</b> El tiempo se reduce seg√∫n el nivel.
        </div>
        <button class="btn-main" onclick="go(2)">CONFIGURAR SESI√ìN</button>
    </div>

    <div id="s2" class="screen">
        <h1>DIFICULTAD</h1>
        <input type="range" id="i-lvl" min="1" max="10" value="1" style="width:100%; accent-color:var(--accent-color)" oninput="sync()">
        <h2 id="v-lvl" style="font-size: 4rem; color: var(--accent-color); margin: 10px 0;">NIVEL 1</h2>
        <button class="btn-main" onclick="startGame()">¬°INICIAR FUEGO!</button>
    </div>

    <div id="game-area"></div>

    <div id="s-final" class="screen">
        <h1 style="color: var(--success);">FIN DE LA RONDA</h1>
        <p id="res-txt" style="font-size: 1.5rem;"></p>
        <button class="btn-main" onclick="location.reload()">REINTENTAR</button>
    </div>

    <script>
        let currentIdx = 0, level, interval;
        const totalSlots = 30; 
        const distractors = ['#', '&', 'X', '?', '%'];

        function go(n) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            if(n === 'final') document.getElementById('s-final').classList.add('active');
            else document.getElementById(`s${n}`).classList.add('active');
        }

        function sync() {
            document.getElementById('v-lvl').innerText = "NIVEL " + document.getElementById('i-lvl').value;
        }

        function startGame() {
            level = parseInt(document.getElementById('i-lvl').value);
            const area = document.getElementById('game-area');
            area.innerHTML = '';
            area.style.display = 'grid';
            document.getElementById('s2').classList.remove('active');

            for(let i=0; i<totalSlots; i++) {
                const slot = document.createElement('div');
                slot.className = 'slot';
                const stim = document.createElement('div');
                stim.className = 'stimulus';
                stim.id = `st-${i}`;
                
                // 30% de probabilidad de ser un distractor
                if(Math.random() > 0.7) {
                    stim.innerText = distractors[Math.floor(Math.random()*distractors.length)];
                    stim.classList.add('distractor');
                } else {
                    stim.innerText = Math.floor(Math.random() * 9) + 1;
                }
                
                // Desplazamiento aleatorio para que no sea perfecto
                stim.style.setProperty('--rx', (Math.random()*20 - 10) + 'px');
                stim.style.setProperty('--ry', (Math.random()*20 - 10) + 'px');
                
                slot.appendChild(stim);
                area.appendChild(slot);
            }

            const speed = 1800 - (level * 150);
            highlightNext();
            interval = setInterval(highlightNext, speed);
        }

        function highlightNext() {
            if(currentIdx > 0) document.getElementById(`st-${currentIdx-1}`).classList.remove('active');
            
            if(currentIdx < totalSlots) {
                const el = document.getElementById(`st-${currentIdx}`);
                el.classList.add('active');
                // Si es un distractor, saltar m√°s r√°pido o marcar ritmo
                currentIdx++;
            } else {
                finish();
            }
        }

        function finish() {
            clearInterval(interval);
            document.getElementById('game-area').style.display = 'none';
            document.getElementById('res-txt').innerHTML = `Completado en <b>Nivel ${level}</b>.<br>Entrenamiento de 40 cm finalizado.`;
            go('final');

            const formURL = "https://docs.google.com/forms/d/e/1FAIpQLSeLlcvlhrTSHDhvxctLghiM3caGsgBL2wdaT7nBxrz6UARwYg/formResponse";
            const params = new URLSearchParams();
            params.append("entry.369874016", "PACIENTE_PRO"); 
            params.append("entry.1353470174", "SACADICOS_DINAMICOS"); 
            params.append("entry.721051298", level); 
            params.append("entry.1030094511", "40cm"); 
            params.append("entry.845098414", new Date().toISOString().split('T')[0]); 
            fetch(formURL, { method: "POST", mode: "no-cors", body: params });
        }
    </script>
</body>
</html>
