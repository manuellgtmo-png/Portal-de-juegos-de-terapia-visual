<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sac√°dicos Voice Master - Perceptum</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #020617; --accent-color: #a855f7; --text-color: #f8fafc;
            --success: #10b981; --danger: #ef4444;
        }
        body {
            margin: 0; font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-color); color: var(--text-color);
            height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden;
        }
        .screen {
            background: rgba(30, 41, 59, 0.95); padding: 40px; border-radius: 40px;
            border: 3px solid var(--accent-color); text-align: center;
            max-width: 600px; width: 90%; position: absolute; z-index: 100; display: none;
        }
        .active { display: block; }
        .hud {
            position: absolute; top: 20px; width: 100%; display: flex;
            justify-content: space-around; font-size: 1.5rem; font-weight: 900; z-index: 50;
        }
        #game-area { display: none; width: 100vw; height: 100vh; position: relative; }
        .stimulus {
            position: absolute; font-size: var(--sz); color: var(--accent-color);
            transform: translate(-50%, -50%); filter: drop-shadow(0 0 15px var(--accent-color));
            transition: color 0.2s;
        }
        .stimulus.warning { color: var(--danger); animation: shake 0.1s infinite; }
        @keyframes shake { 0%, 100% { transform: translate(-50%, -50%) rotate(0deg); } 25% { transform: translate(-50%, -50%) rotate(5deg); } 75% { transform: translate(-50%, -50%) rotate(-5deg); } }
        .btn-main { background: var(--success); color: #000; border: none; padding: 20px; border-radius: 20px; font-weight: 900; font-size: 1.5rem; cursor: pointer; width: 100%; margin-top: 20px; }
        .mic-status { font-size: 0.8rem; margin-top: 10px; color: var(--success); opacity: 0.8; }
    </style>
</head>
<body>

    <div class="hud" id="hud" style="display:none">
        <div>NIVEL: <span id="h-lvl" style="color:var(--accent-color)">1</span></div>
        <div>VIDAS: <span id="h-lives" style="color:var(--danger)">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
    </div>

    <div id="s1" class="screen active">
        <h1 style="color: var(--accent-color);">VOICE MASTER SAC√ÅDICOS</h1>
        <p>Entrenamiento controlado por voz a <b>40 cm</b>.</p>
        <div style="text-align: left; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 20px; font-size: 0.9rem;">
            üé§ <b>Paso 1:</b> Permite el uso del micr√≥fono.<br>
            üó£Ô∏è <b>Paso 2:</b> Di el n√∫mero o letra en voz alta r√°pidamente.<br>
            üß† <b>Paso 3:</b> Solo pasar√°s de nivel si pronuncias el correcto.
        </div>
        <button class="btn-main" onclick="initVoice()">ACTIVAR MICR√ìFONO</button>
        <div id="mic-info" class="mic-status" style="display:none">‚úÖ Micr√≥fono detectado</div>
    </div>

    <div id="game-area"></div>

    <div id="s-final" class="screen">
        <h1 style="color: var(--danger);">FIN DE SESI√ìN</h1>
        <p id="res-txt" style="font-size: 1.5rem;"></p>
        <button class="btn-main" onclick="location.reload()">REINTENTAR</button>
    </div>

    <script>
        let level = 1, lives = 3, currentVal = "";
        let recognition;
        const stimuli = "123456789ABCDEFHKMNPRTUVWXY"; // Mix de n√∫meros y letras f√°ciles de reconocer

        function initVoice() {
            window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!window.SpeechRecognition) {
                alert("Tu navegador no soporta reconocimiento de voz. Usa Chrome o Edge.");
                return;
            }
            recognition = new SpeechRecognition();
            recognition.lang = 'es-ES';
            recognition.continuous = true;
            recognition.interimResults = false;

            recognition.onresult = (event) => {
                const speechToText = event.results[event.results.length - 1][0].transcript.trim().toUpperCase();
                console.log("Escuchado:", speechToText);
                checkAnswer(speechToText);
            };

            recognition.start();
            document.getElementById('mic-info').style.display = 'block';
            setTimeout(startGame, 1000);
        }

        function startGame() {
            document.getElementById('s1').classList.remove('active');
            document.getElementById('game-area').style.display = 'block';
            document.getElementById('hud').style.display = 'flex';
            spawn();
        }

        function spawn() {
            const area = document.getElementById('game-area');
            area.innerHTML = '';
            
            currentVal = stimuli[Math.floor(Math.random() * stimuli.length)];
            const speed = Math.max(800, 3500 - (level * 150)); // Un poco m√°s de tiempo para procesar voz
            const size = Math.floor(Math.random() * (110 - 50 + 1)) + 50;
            
            const stim = document.createElement('div');
            stim.className = 'stimulus';
            stim.id = "active-stim";
            stim.innerText = currentVal;
            stim.style.left = `${Math.random() * 80 + 10}%`;
            stim.style.top = `${Math.random() * 70 + 15}%`;
            stim.style.setProperty('--sz', `${size}px`);
            area.appendChild(stim);

            // Temporizador de fallo
            stim.failTimer = setTimeout(() => {
                lives--;
                updateHUD();
                if(lives <= 0) endGame();
                else spawn();
            }, speed);

            stim.warningTimer = setTimeout(() => stim.classList.add('warning'), speed * 0.6);
        }

        function checkAnswer(val) {
            // El reconocimiento a veces devuelve palabras (ej: "Siete" en vez de "7")
            const map = {"UNO": "1", "DOS": "2", "TRES": "3", "CUATRO": "4", "CINCO": "5", "SEIS": "6", "SIETE": "7", "OCHO": "8", "NUEVE": "9"};
            const finalVal = map[val] || val;

            if (finalVal.includes(currentVal)) {
                const stim = document.getElementById('active-stim');
                clearTimeout(stim.failTimer);
                clearTimeout(stim.warningTimer);
                level++;
                updateHUD();
                spawn();
            }
        }

        function updateHUD() {
            document.getElementById('h-lvl').innerText = level;
            document.getElementById('h-lives').innerText = "‚ù§Ô∏è".repeat(lives);
        }

        function endGame() {
            recognition.stop();
            document.getElementById('game-area').style.display = 'none';
            document.getElementById('hud').style.display = 'none';
            document.getElementById('res-txt').innerHTML = `Nivel alcanzado: ${level}`;
            document.getElementById('s-final').classList.add('active');
        }
    </script>
</body>
</html>
