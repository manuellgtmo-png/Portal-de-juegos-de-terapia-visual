<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enigma de Snellen - Perceptum</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #f8fafc; color: #1e293b; font-family: 'Montserrat', sans-serif; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }
        
        /* Distractores Animados */
        .bubble { position: absolute; border-radius: 50%; opacity: 0.2; animation: float 15s infinite linear; z-index: 0; pointer-events: none; }
        @keyframes float { from { transform: translateY(110vh) rotate(0deg); } to { transform: translateY(-10vh) rotate(360deg); } }

        /* HUD Stats */
        #ui-layer { position: fixed; top: 0; width: 100%; padding: 20px; display: flex; justify-content: space-between; box-sizing: border-box; z-index: 10; }
        .stat-box { background: white; padding: 10px 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); font-weight: 900; border: 2px solid #e2e8f0; }

        /* Área de Juego */
        #game-container { text-align: center; width: 100%; max-width: 600px; padding: 20px; z-index: 5; }
        #optotipo-wrapper { height: 250px; display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .optotipo { font-weight: 900; color: #0f172a; transition: all 0.3s; }
        
        /* Controles */
        .controles { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 100%; max-width: 350px; margin: 0 auto; }
        .btn-dir { background: white; border: 4px solid #1e293b; padding: 20px; font-size: 1.8rem; border-radius: 20px; cursor: pointer; transition: 0.1s; box-shadow: 0 6px 0 #1e293b; }
        .btn-dir:active { transform: translateY(3px); box-shadow: 0 3px 0 #1e293b; }

        /* Modales e Instrucciones */
        .overlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.9); display: flex; align-items: center; justify-content: center; z-index: 100; color: white; padding: 20px; text-align: center; }
        .modal { background: white; color: #1e293b; padding: 30px; border-radius: 30px; max-width: 400px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .btn-ready { background: #22c55e; color: white; padding: 15px 40px; border-radius: 20px; font-weight: 900; border: none; cursor: pointer; margin-top: 20px; text-transform: uppercase; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="stat-box">Nivel: <span id="txt-nivel">1</span></div>
        <div class="stat-box">⏱️ <span id="txt-tiempo">0s</span></div>
        <div class="stat-box">Vidas: <span id="txt-vidas">❤️❤️❤️</span></div>
    </div>

    <div id="modal-instrucciones" class="overlay">
        <div class="modal">
            <h2 style="color: #6366f1;">¿Cómo jugar?</h2>
            <p>Observa la secuencia de las <b>"E"</b>. <br>Memoriza sus posiciones y repítelas usando las flechas después de que desaparezcan.</p>
            <button class="btn-ready" onclick="cerrarInstrucciones()">¡Empezar!</button>
        </div>
    </div>

    <div id="modal-next" class="overlay" style="display:none;">
        <div class="modal">
            <h2 style="color: #22c55e;">¡Excelente!</h2>
            <p>Has completado el patrón correctamente.</p>
            <button class="btn-ready" onclick="proximoNivel()">Siguiente Nivel</button>
        </div>
    </div>

    <div id="game-container">
        <div id="optotipo-wrapper"></div>
        <p id="instruccion-fase" style="font-weight: bold; color: #64748b;">Observa el patrón...</p>
        <div class="controles" id="pad-controles" style="pointer-events: none; opacity: 0.5;">
            <button class="btn-dir" onclick="registrarEntrada('ARRIBA')">↑</button>
            <button class="btn-dir" onclick="registrarEntrada('ABAJO')">↓</button>
            <button class="btn-dir" onclick="registrarEntrada('IZQUIERDA')">←</button>
            <button class="btn-dir" onclick="registrarEntrada('DERECHA')">→</button>
        </div>
    </div>

    <script>
        let nivel = 1;
        let vidas = 3;
        let tiempoSec = 0;
        let timerInterval;
        let secuenciaActual = [];
        let secuenciaUsuario = [];
        let tamañoActual = 120;
        const direcciones = ["ARRIBA", "ABAJO", "IZQUIERDA", "DERECHA"];
        const rotaciones = { "ARRIBA": "-90deg", "ABAJO": "90deg", "IZQUIERDA": "180deg", "DERECHA": "0deg" };

        function crearBurbujas() {
            for(let i=0; i<10; i++) {
                let b = document.createElement('div');
                b.className = 'bubble';
                let size = Math.random() * 50 + 20;
                b.style.width = size + 'px';
                b.style.height = size + 'px';
                b.style.left = Math.random() * 100 + 'vw';
                b.style.background = ['#6366f1', '#22c55e', '#f59e0b', '#ec4899'][Math.floor(Math.random()*4)];
                b.style.animationDelay = Math.random() * 10 + 's';
                document.body.appendChild(b);
            }
        }

        function cerrarInstrucciones() {
            document.getElementById('modal-instrucciones').style.display = 'none';
            iniciarJuego();
        }

        function iniciarJuego() {
            crearBurbujas();
            timerInterval = setInterval(() => { tiempoSec++; document.getElementById('txt-tiempo').innerText = tiempoSec + "s"; }, 1000);
            generarPatron();
        }

        function generarPatron() {
            secuenciaActual = [];
            secuenciaUsuario = [];
            const wrapper = document.getElementById('optotipo-wrapper');
            const numSimbolos = Math.min(6, 1 + Math.floor(nivel / 2)); 
            wrapper.innerHTML = '';
            document.getElementById('instruccion-fase').innerText = "Observa el patrón...";
            document.getElementById('pad-controles').style.pointer-events = "none";
            document.getElementById('pad-controles').style.opacity = "0.5";

            for(let i=0; i < numSimbolos; i++) {
                let dir = direcciones[Math.floor(Math.random() * direcciones.length)];
                secuenciaActual.push(dir);
                let el = document.createElement('div');
                el.className = 'optotipo';
                el.innerText = 'E';
                el.style.fontSize = tamañoActual + 'px';
                el.style.transform = `rotate(${rotaciones[dir]})`;
                wrapper.appendChild(el);
            }

            setTimeout(() => {
                wrapper.innerHTML = '<h1 style="font-size:3rem">?</h1>';
                document.getElementById('instruccion-fase').innerText = "¡Repite la secuencia!";
                document.getElementById('pad-controles').style.pointer-events = "auto";
                document.getElementById('pad-controles').style.opacity = "1";
            }, 1500 + (nivel * 200));
        }

        function registrarEntrada(dir) {
            secuenciaUsuario.push(dir);
            if (dir !== secuenciaActual[secuenciaUsuario.length - 1]) {
                vidas--;
                document.getElementById('txt-vidas').innerText = "❤️".repeat(vidas);
                if(vidas <= 0) { alert("Fin del juego. Sincronizando..."); location.reload(); }
                else { alert("Secuencia incorrecta. Intenta de nuevo."); generarPatron(); }
                return;
            }
            if (secuenciaUsuario.length === secuenciaActual.length) {
                document.getElementById('modal-next').style.display = 'flex';
            }
        }

        function proximoNivel() {
            nivel++;
            tamañoActual = Math.max(20, tamañoActual * 0.9);
            document.getElementById('txt-nivel').innerText = nivel;
            document.getElementById('modal-next').style.display = 'none';
            generarPatron();
        }
    </script>
</body>
</html>
