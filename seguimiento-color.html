<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguimiento de Color - Centro Perceptum</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; color: white; font-family: 'Montserrat', sans-serif; overflow: hidden; touch-action: none; }
        
        /* Pantalla de Introducci√≥n */
        #intro-screen, #result-screen {
            position: fixed; inset: 0; background: #1e293b;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 30px; text-align: center; z-index: 200;
        }
        .card { background: white; color: #1e293b; padding: 30px; border-radius: 30px; max-width: 500px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .habilidades { background: #e0e7ff; color: #4338ca; padding: 12px; border-radius: 15px; font-size: 0.9rem; margin: 15px 0; font-weight: bold; }
        
        button { 
            background: #22c55e; color: white; border: none; padding: 18px 40px; 
            border-radius: 50px; font-size: 1.2rem; cursor: pointer; font-weight: 900;
            transition: transform 0.2s; text-transform: uppercase;
        }
        button:hover { transform: scale(1.05); }

        /* Interfaz de Juego */
        #ui-layer { 
            position: absolute; top: 0; width: 100%; padding: 20px;
            display: flex; justify-content: space-between; box-sizing: border-box;
            pointer-events: none; z-index: 100; display: none;
        }
        .stat-box { background: rgba(255,255,255,0.15); backdrop-filter: blur(5px); padding: 10px 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.3); }
        .vidas { color: #ff4444; font-size: 1.5rem; }
        
        canvas { display: block; cursor: crosshair; }
    </style>
</head>
<body>

    <div id="intro-screen">
        <div class="card">
            <h1 style="margin:0; font-size: 2rem;">üåà Seguimiento M√°gico</h1>
            <div class="habilidades">üéØ Habilidades: Seguimiento Visual, Fijaci√≥n Sostenida y Motilidad Ocular.</div>
            <p style="color: #64748b; line-height: 1.5;"><strong>Para Padres:</strong> El ni√±o debe mantener el contacto con el c√≠rculo de color. Si lo suelta, el c√≠rculo se pondr√° p√°lido y perder√° energ√≠a (vidas).</p>
            <button onclick="iniciarJuego()">¬°Empezar Terapia!</button>
        </div>
    </div>

    <div id="result-screen" style="display: none;">
        <div class="card">
            <h2 id="result-title">¬°Nivel Completado!</h2>
            <p id="result-text"></p>
            <button id="next-btn" onclick="proximoNivel()">Siguiente Nivel</button>
            <a href="index.html" style="display:block; margin-top:20px; color:#6366f1; text-decoration:none; font-weight:bold;">Volver al Men√∫ Principal</a>
        </div>
    </div>

    <div id="ui-layer">
        <div class="stat-box">Nivel: <span id="txt-nivel" style="font-weight:900">1</span></div>
        <div class="stat-box">Tiempo: <span id="txt-tiempo" style="font-weight:900">00:00</span></div>
        <div class="stat-box" id="txt-vidas">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const ui = document.getElementById('ui-layer');
        
        // Variables de Juego
        let nivelActual = 1;
        let vidas = 3;
        let segundos = 0;
        let juegoActivo = false;
        let enContacto = false;
        let framesFuera = 0;
        let cronometroInterval;

        // Configuraci√≥n de Est√≠mulo
        let x, y, dx, dy, radio;
        const colores = ['#FF0000', '#00FF00', '#0000FF']; // Colores Primarios

        function ajustarDificultad() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            x = canvas.width / 2;
            y = canvas.height / 2;
            
            // Nivel 1: Muy grande y lento. Nivel 3: Peque√±o y r√°pido.
            radio = 80 - (nivelActual * 10); 
            let velocidad = 1.5 + (nivelActual * 0.8);
            dx = velocidad;
            dy = velocidad;
        }

        function iniciarJuego() {
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            ui.style.display = 'flex';
            ajustarDificultad();
            vidas = 3;
            segundos = 0;
            actualizarUI();
            juegoActivo = true;
            
            if(cronometroInterval) clearInterval(cronometroInterval);
            cronometroInterval = setInterval(() => {
                if(juegoActivo && enContacto) segundos++;
                actualizarUI();
            }, 1000);
            
            render();
        }

        function actualizarUI() {
            document.getElementById('txt-nivel').innerText = nivelActual;
            document.getElementById('txt-vidas').innerText = "‚ù§Ô∏è".repeat(vidas);
            let min = Math.floor(segundos / 60);
            let seg = segundos % 60;
            document.getElementById('txt-tiempo').innerText = `${min < 10 ? '0' : ''}${min}:${seg < 10 ? '0' : ''}${seg}`;
        }

        // Detecci√≥n de contacto (Mouse y Touch)
        const checkContacto = (ex, ey) => {
            let dist = Math.sqrt((ex - x)**2 + (ey - y)**2);
            enContacto = dist < radio;
        };

        canvas.addEventListener('mousemove', (e) => checkContacto(e.clientX, e.clientY));
        canvas.addEventListener('touchmove', (e) => checkContacto(e.touches[0].clientX, e.touches[0].clientY));
        canvas.addEventListener('touchstart', (e) => checkContacto(e.touches[0].clientX, e.touches[0].clientY));
        canvas.addEventListener('touchend', () => enContacto = false);

        function finalizarNivel(exito) {
            juegoActivo = false;
            clearInterval(cronometroInterval);
            document.getElementById('result-screen').style.display = 'flex';
            document.getElementById('result-title').innerText = exito ? "¬°Excelente Trabajo!" : "¬°Sigue Intentando!";
            document.getElementById('result-text').innerText = `Tiempo de fijaci√≥n: ${segundos} segundos.`;
            document.getElementById('next-btn').innerText = exito ? "Siguiente Nivel" : "Reintentar Nivel";
        }

        function proximoNivel() {
            if(vidas > 0) nivelActual++;
            if(nivelActual > 3) nivelActual = 1; // Reinicia o podr√≠as mandar a otro juego
            iniciarJuego();
        }

        function render() {
            if(!juegoActivo) return;

            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // L√≥gica de Vidas: Si no hay contacto, el c√≠rculo se "apaga" y pierde vida tras 1.5 segundos
            if (!enContacto) {
                framesFuera++;
                ctx.globalAlpha = 0.3; // Se vuelve transparente
                if(framesFuera > 90) { // Aproximadamente 1.5 segundos a 60fps
                    vidas--;
                    framesFuera = 0;
                    if(vidas <= 0) return finalizarNivel(false);
                }
            } else {
                framesFuera = 0;
                ctx.globalAlpha = 1.0;
            }

            // Dibujar Est√≠mulo
            ctx.beginPath();
            ctx.arc(x, y, radio, 0, Math.PI * 2);
            ctx.fillStyle = colores[(nivelActual - 1) % 3];
            ctx.fill();
            ctx.strokeStyle = "white";
            ctx.lineWidth = 5;
            ctx.stroke();
            ctx.closePath();
            ctx.globalAlpha = 1.0;

            // Movimiento Lineal (Podemos expandir a Circular/Infinito en el siguiente paso)
            x += dx; y += dy;
            if(x + radio > canvas.width || x - radio < 0) dx = -dx;
            if(y + radio > canvas.height || y - radio < 0) dy = -dy;

            // Meta de tiempo por nivel (ejemplo: 30 segundos)
            if(segundos >= 30) finalizarNivel(true);

            requestAnimationFrame(render);
        }

        window.onresize = ajustarDificultad;
    </script>
</body>
</html>
